# TS-tools

This is the repository corresponding to the TS-tools project.

### Setting up the environment

To set up the ts-tools conda environment:

```
conda env create -f environment.yml
```

To install the TS-tools package, activate the ts-tools environment and run the following command within the TS-tools directory:

```
conda activate ts-tools
pip install .
```

Additionally, Gaussian16 needs to be available. In HPC environments, this can typically be achieved by loading the corresponding module to the path:

```
module load gaussian/g16_C01
```

Finally, the xTB path in the external xtb script needs to be adapted to the local settings (L13 in 'xtb/external_script/xtb_external.py')

### Generating TS guesses at xTB level-of-theory

TS guesses at xTB level of theory can be generated by running the following command (individual calculations are run in parallel as a single Python ProcessPool):

```
python run_scripts/run_ts_searcher.py [--input-file data/reactions_am.txt] [--xtb-external-path xtb_external_script/xtb_external.py]
```

where the ’input-file’ command line option corresponds to the location of the .txt-file containing the reaction SMILES (the default value ’reactions_am.txt’ corresponds to the benchmarking reactions), 
and the ’xtb-external-path’ option corresponds to the location of the script to use xTB as an external method in Gaussian16 (copied from the Jensen group's [xtb_gaussian](https://github.com/jensengroup/xtb_gaussian/blob/main/xtb_external.py) repository).  

Additional options can also be provided:

1. '--reactive-complex-factors-intra': Specifies a list of floating-point numbers representing reactive complex factors for intra-molecular interactions.
2. '--reactive-complex-factors-inter': Specifies a list of floating-point numbers representing reactive complex factors for inter-molecular interactions.
3. '--solvent': Specifies the name of the solvent (needs to be supported in xTB, e.g., 'water')
4. '--freq-cut-off': Specifies the imaginary frequency cut-off used during filtering of plausible starting points for transition state guess optimization.
5. '--target-dir': Specifies the working directory in which all files will be saved; final reactant, product and TS guess geometries (as well as the TS .log file) are saved in another directory with the ’final_’ prefix.

### Validating TS guesses at DFT level of theory  

Validating TS guesses at xTB level-of-theory can be done by running the following command (individual calculations are run in parallel as a single Python ProcessPool):

```
python run_scripts/dft_validation.py [--input-file data/reactions_am.txt] [--input-dir final_work_dir]
``` 

where the ’input-file’ command line option corresponds to the location of the .txt-file containing the reaction SMILES (the default value ’reactions_am.txt’ corresponds to the benchmarking reactions),
and the ’input-dir’ command line option corresponds to the location of the folder in which the final TS guess geometries have been saved (see previous section.

Additional options can also be provided:

1. '--solvent': Specifies the name of the solvent (needs to be supported both in Gaussian16, e.g., 'water')
2. '--output-dir': Specifies the working directory in which all files will be saved.
3. '--mem': Specifies the memory requested in the Gaussian16 .com files (default is '16GB')
4. '--proc': Specifies the number of processors requested in the Gaussian16 .com files (default is 8) 
5. '--functional': Specifies the functional to be used for the DFT calculations (default is 'UB3LYP')
6. '--basis-set': Specifies the basis set to be used for the DFT calculations (default is '6-31G**')

### Generating TS guesses at DFT level of theory

TS guesses at DFT level-of-theory (from an xTB reactive path) can be generated by running the following command (individual calculations are run in parallel as a single Python ProcessPool):

```
python run_scripts/run_ts_searcher_dft.py [--input-file data/reactions_am.txt] [--xtb-external-path xtb_external_script/xtb_external.py]
```

where the ’input-file’ command line option corresponds to the location of the .txt-file containing the reaction SMILES (the default value ’reactions_am.txt’ corresponds to the benchmarking reactions),
and the ’xtb-external-path’ option corresponds to the location of the script to use xTB as an external method in Gaussian16 (copied from the Jensen group's [xtb_gaussian](https://github.com/jensengroup/xtb_gaussian/blob/main/xtb_external.py) repository).
Note that this script will be a lot slower than xTB optimization of TSs, and should consequently only be used when full xTB level-of-theory TS guess generation fails.

Additional options can also be provided:

1. '--reactive-complex-factors-intra': Specifies a list of floating-point numbers representing reactive complex factors for intra-molecular interactions.
2. '--reactive-complex-factors-inter': Specifies a list of floating-point numbers representing reactive complex factors for inter-molecular interactions.
3. '--solvent': Specifies the name of the solvent to be used in both the xTB and DFT calculations
4. '--xtb_solvent': Specifies the name of the solvent to be used in the xTB calculations (only needed when universal 'solvent' keyword is not specified)
5. '--dft_solvent': Specifies the name of the solvent to be used in the DFT calculations (only needed when universal 'solvent' keyword is not specified)
6. '--freq-cut-off': Specifies the imaginary frequency cut-off used during filtering of plausible starting points for transition state guess optimization.
7. '--target-dir': Specifies the working directory in which all files will be saved; final reactant, product and TS guess geometries (as well as the TS .log file) are saved in another 
directory with the ’final_’ prefix.
8. '--mem': Specifies the memory requested in the Gaussian16 .com files (default is '16GB')
9. '--proc': Specifies the number of processors requested in the Gaussian16 .com files (default is 8)
10. '--functional': Specifies the functional to be used for the DFT calculations (default is 'UB3LYP')
11. '--basis-set': Specifies the basis set to be used for the DFT calculations (default is '6-31G**')

### References

If (parts of) this workflow are used as part of a publication, please cite the associated paper:

```
xxx
``` 

Furthermore, since the workflow makes use of autodE at several instances, also consider citing the paper in which this code was originally presented:

```
@article{autodE,
  doi = {10.1002/anie.202011941},
  url = {https://doi.org/10.1002/anie.202011941},
  year = {2021},
  publisher = {Wiley},
  volume = {60},
  number = {8},
  pages = {4266--4274},
  author = {Tom A. Young and Joseph J. Silcock and Alistair J. Sterling and Fernanda Duarte},
  title = {{autodE}: Automated Calculation of Reaction Energy Profiles -- Application to Organic and Organometallic Reactions},
  journal = {Angewandte Chemie International Edition}
}
```

